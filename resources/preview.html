<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件预览</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <header><!-- 与首页相同的头部 --></header>

    <main class="container">
        <h1 id="fileName"></h1>
        <div class="file-meta">
            <p>文件类型：<span id="fileType"></span></p>
            <p>文件大小：<span id="fileSize"></span></p>
            <p>最后更新：<span id="fileDate"></span></p>
        </div>
        <a id="downloadBtn" class="btn">下载文件</a>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const params = new URLSearchParams(location.search);
        const fileName = params.get('file');
        
        const config = {
            owner: 'ginvgo',
            repo: 'DS2325',
            path: 'resources'
        };

        try {
            // 获取文件元数据
            const fileRes = await fetch(
                `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}/${fileName}`
            );
            const fileData = await fileRes.json();

            // 获取提交信息
            const commitRes = await fetch(
                `https://api.github.com/repos/${config.owner}/${config.repo}/commits?path=${config.path}/${fileName}&per_page=1`
            );
            const [commit] = await commitRes.json();

            // 显示信息
            document.getElementById('fileName').textContent = fileData.name;
            document.getElementById('fileType').textContent = fileData.name.split('.').pop().toUpperCase();
            document.getElementById('fileDate').textContent = 
                new Date(commit.commit.committer.date).toLocaleDateString();
                
            // 获取精确文件大小
            const headRes = await fetch(fileData.download_url, { method: 'HEAD' });
            const size = headRes.headers.get('content-length');
            document.getElementById('fileSize').textContent = 
                (size/1024/1024).toFixed(2) + ' MB';

            // 设置下载按钮
            document.getElementById('downloadBtn').href = fileData.download_url;
        } catch (error) {
            console.error('加载失败:', error);
            alert('文件加载失败，请稍后重试');
        }
    });
    </script>
</body>
</html>
